from pyspark.sql.types import *
from optimus import Optimus
from optimus.helpers.json import json_enconding
from optimus.helpers.functions import deep_sort
import unittest
nan = op.nan
import datetime
null = None
true = True
op = Optimus(master='local')
source_df=op.create.df({"NullType":{"0":null,"1":null,"2":null,"3":null,"4":null,"5":null},"attributes":{"0":[8.5344,4300.0],"1":[5.334,2000.0],"2":[7.9248,4000.0],"3":[3.9624,1800.0],"4":[null,5700.0],"5":[91.44,null]},"date arrival":{"0":"1980\/04\/10","1":"1980\/04\/10","2":"1980\/04\/10","3":"1980\/04\/10","4":"1980\/04\/10","5":"1980\/04\/10"},"function(binary)":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{}},"height(ft)":{"0":-28.0,"1":17.0,"2":26.0,"3":13.0,"4":null,"5":300.0},"japanese name":{"0":["Inochi","Convoy"],"1":["Bumble","Goldback"],"2":["Roadbuster"],"3":["Meister"],"4":["Megatron"],"5":["Metroflex"]},"last date seen":{"0":"2016\/09\/10","1":"2015\/08\/10","2":"2014\/07\/10","3":"2013\/06\/10","4":"2012\/05\/10","5":"2011\/04\/10"},"last position seen":{"0":"19.442735,-99.201111","1":"10.642707,-71.612534","2":"37.789563,-122.400356","3":"33.670666,-117.841553","4":null,"5":null},"rank":{"0":10,"1":7,"2":7,"3":8,"4":10,"5":8},"Cybertronian":{"0":true,"1":true,"2":true,"3":true,"4":true,"5":true},"Date Type":{"0":1473465600000,"1":1439164800000,"2":1403568000000,"3":1372032000000,"4":1336608000000,"5":1302393600000},"age":{"0":5000000,"1":5000000,"2":5000000,"3":5000000,"4":5000000,"5":5000000},"function":{"0":"Leader","1":"Espionage","2":"Security","3":"First Lieutenant","4":"None","5":"Battle Station"},"names":{"0":"Optimus","1":"bumbl#eb\u00e9\u00e9  ","2":"ironhide&","3":"Jazz","4":"Megatron","5":"Metroplex_)^$"},"timestamp":{"0":1403568000000,"1":1403568000000,"2":1403568000000,"3":1403568000000,"4":1403568000000,"5":1403568000000},"weight(t)":{"0":4.3,"1":2.0,"2":4.0,"3":1.8,"4":5.7,"5":null}})
class Test_df_ext(unittest.TestCase):
	maxDiff = None
	@staticmethod
	def test_sample():
		actual_df =source_df.sample(5,True)
		expected_df = op.create.df({"NullType":{"1":null,"3":null,"2":null,"5":null,"4":null,"0":null},"attributes":{"1":[5.334,2000.0],"3":[3.9624,1800.0],"2":[7.9248,4000.0],"5":[91.44,null],"4":[null,5700.0],"0":[8.5344,4300.0]},"date arrival":{"1":"1980\/04\/10","3":"1980\/04\/10","2":"1980\/04\/10","5":"1980\/04\/10","4":"1980\/04\/10","0":"1980\/04\/10"},"function(binary)":{"1":{},"3":{},"2":{},"5":{},"4":{},"0":{}},"height(ft)":{"1":17.0,"3":13.0,"2":26.0,"5":300.0,"4":null,"0":-28.0},"japanese name":{"1":["Bumble","Goldback"],"3":["Meister"],"2":["Roadbuster"],"5":["Metroflex"],"4":["Megatron"],"0":["Inochi","Convoy"]},"last date seen":{"1":"2015\/08\/10","3":"2013\/06\/10","2":"2014\/07\/10","5":"2011\/04\/10","4":"2012\/05\/10","0":"2016\/09\/10"},"last position seen":{"1":"10.642707,-71.612534","3":"33.670666,-117.841553","2":"37.789563,-122.400356","5":null,"4":null,"0":"19.442735,-99.201111"},"rank":{"1":7,"3":8,"2":7,"5":8,"4":10,"0":10},"Cybertronian":{"1":true,"3":true,"2":true,"5":true,"4":true,"0":true},"Date Type":{"1":1439164800000,"3":1372032000000,"2":1403568000000,"5":1302393600000,"4":1336608000000,"0":1473465600000},"age":{"1":5000000,"3":5000000,"2":5000000,"5":5000000,"4":5000000,"0":5000000},"function":{"1":"Espionage","3":"First Lieutenant","2":"Security","5":"Battle Station","4":"None","0":"Leader"},"names":{"1":"bumbl#eb\u00e9\u00e9  ","3":"Jazz","2":"ironhide&","5":"Metroplex_)^$","4":"Megatron","0":"Optimus"},"timestamp":{"1":1403568000000,"3":1403568000000,"2":1403568000000,"5":1403568000000,"4":1403568000000,"0":1403568000000},"weight(t)":{"1":2.0,"3":1.8,"2":4.0,"5":null,"4":5.7,"0":4.3}})
		assert (expected_df.collect() == actual_df.collect())
	@staticmethod
	def test_stratified_sample():
		actual_df =source_df.stratified_sample('rank',12)
		expected_df = op.create.df({"NullType":{"(7, 2)":null,"(7, 1)":null,"(8, 3)":null,"(8, 5)":null,"(10, 4)":null,"(10, 0)":null},"attributes":{"(7, 2)":[7.9248,4000.0],"(7, 1)":[5.334,2000.0],"(8, 3)":[3.9624,1800.0],"(8, 5)":[91.44,null],"(10, 4)":[null,5700.0],"(10, 0)":[8.5344,4300.0]},"date arrival":{"(7, 2)":"1980\/04\/10","(7, 1)":"1980\/04\/10","(8, 3)":"1980\/04\/10","(8, 5)":"1980\/04\/10","(10, 4)":"1980\/04\/10","(10, 0)":"1980\/04\/10"},"function(binary)":{"(7, 2)":{},"(7, 1)":{},"(8, 3)":{},"(8, 5)":{},"(10, 4)":{},"(10, 0)":{}},"height(ft)":{"(7, 2)":26.0,"(7, 1)":17.0,"(8, 3)":13.0,"(8, 5)":300.0,"(10, 4)":null,"(10, 0)":-28.0},"japanese name":{"(7, 2)":["Roadbuster"],"(7, 1)":["Bumble","Goldback"],"(8, 3)":["Meister"],"(8, 5)":["Metroflex"],"(10, 4)":["Megatron"],"(10, 0)":["Inochi","Convoy"]},"last date seen":{"(7, 2)":"2014\/07\/10","(7, 1)":"2015\/08\/10","(8, 3)":"2013\/06\/10","(8, 5)":"2011\/04\/10","(10, 4)":"2012\/05\/10","(10, 0)":"2016\/09\/10"},"last position seen":{"(7, 2)":"37.789563,-122.400356","(7, 1)":"10.642707,-71.612534","(8, 3)":"33.670666,-117.841553","(8, 5)":null,"(10, 4)":null,"(10, 0)":"19.442735,-99.201111"},"rank":{"(7, 2)":7,"(7, 1)":7,"(8, 3)":8,"(8, 5)":8,"(10, 4)":10,"(10, 0)":10},"Cybertronian":{"(7, 2)":true,"(7, 1)":true,"(8, 3)":true,"(8, 5)":true,"(10, 4)":true,"(10, 0)":true},"Date Type":{"(7, 2)":1403568000000,"(7, 1)":1439164800000,"(8, 3)":1372032000000,"(8, 5)":1302393600000,"(10, 4)":1336608000000,"(10, 0)":1473465600000},"age":{"(7, 2)":5000000,"(7, 1)":5000000,"(8, 3)":5000000,"(8, 5)":5000000,"(10, 4)":5000000,"(10, 0)":5000000},"function":{"(7, 2)":"Security","(7, 1)":"Espionage","(8, 3)":"First Lieutenant","(8, 5)":"Battle Station","(10, 4)":"None","(10, 0)":"Leader"},"names":{"(7, 2)":"ironhide&","(7, 1)":"bumbl#eb\u00e9\u00e9  ","(8, 3)":"Jazz","(8, 5)":"Metroplex_)^$","(10, 4)":"Megatron","(10, 0)":"Optimus"},"timestamp":{"(7, 2)":1403568000000,"(7, 1)":1403568000000,"(8, 3)":1403568000000,"(8, 5)":1403568000000,"(10, 4)":1403568000000,"(10, 0)":1403568000000},"weight(t)":{"(7, 2)":4.0,"(7, 1)":2.0,"(8, 3)":1.8,"(8, 5)":null,"(10, 4)":5.7,"(10, 0)":4.3}})
		assert (expected_df.collect() == actual_df.collect())
